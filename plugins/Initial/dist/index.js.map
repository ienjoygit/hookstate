{"version":3,"file":"index.js","sources":["../src/Initial.ts"],"sourcesContent":["\r\nimport {\r\n    Path,\r\n    Downgraded,\r\n    Plugin,\r\n    StateValueAtPath,\r\n    StateValueAtRoot,\r\n    State,\r\n    StateMethods\r\n} from '@hookstate/core';\r\n\r\nimport isEqual from 'lodash.isequal';\r\nimport cloneDeep from 'lodash.clonedeep';\r\n\r\nexport interface InitialExtensions<S> {\r\n    get(): S | undefined;\r\n    modified(): boolean;\r\n    unmodified(): boolean;\r\n}\r\n\r\nclass InitialPluginInstance {\r\n    private initialState: StateValueAtRoot;\r\n    constructor(initialValue: StateValueAtRoot) {\r\n        this.initialState = cloneDeep(initialValue);\r\n    }\r\n    getInitial = (path: Path) => {\r\n        let result = this.initialState;\r\n        path.forEach(p => {\r\n            result = result && result[p];\r\n        });\r\n        return result;\r\n    }\r\n    getModified = (l: StateMethods<StateValueAtPath>): boolean => {\r\n        l.attach(Downgraded)\r\n        return !isEqual(l.value, this.getInitial(l.path))\r\n    }\r\n}\r\n\r\nconst PluginID = Symbol('Initial');\r\n\r\n// tslint:disable-next-line: function-name\r\nexport function Initial(): Plugin;\r\nexport function Initial<S>($this: State<S>): InitialExtensions<S>;\r\nexport function Initial<S>($this?: State<S>): Plugin | InitialExtensions<S> {\r\n    if ($this) {\r\n        const $th = $this as State<S>\r\n        const [instance] = $th.attach(PluginID);\r\n        if (instance instanceof Error) {\r\n            throw instance;\r\n        }\r\n        const inst = instance as InitialPluginInstance;\r\n        return {\r\n            get: () => inst.getInitial($th.path),\r\n            modified: () => inst.getModified($th),\r\n            unmodified: () => !inst.getModified($th)\r\n        }\r\n    }\r\n    return {\r\n        id: PluginID,\r\n        init: (state: State<StateValueAtRoot>) => {\r\n            return new InitialPluginInstance(state.value) as {}\r\n        }\r\n    }\r\n}\r\n"],"names":["Downgraded"],"mappings":";;;;;;;;;;AAoBA;IAEI,+BAAY,YAA8B;QAA1C,iBAEC;QACD,eAAU,GAAG,UAAC,IAAU;YACpB,IAAI,MAAM,GAAG,KAAI,CAAC,YAAY,CAAC;YAC/B,IAAI,CAAC,OAAO,CAAC,UAAA,CAAC;gBACV,MAAM,GAAG,MAAM,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC;aAChC,CAAC,CAAC;YACH,OAAO,MAAM,CAAC;SACjB,CAAA;QACD,gBAAW,GAAG,UAAC,CAAiC;YAC5C,CAAC,CAAC,MAAM,CAACA,eAAU,CAAC,CAAA;YACpB,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAA;SACpD,CAAA;QAZG,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC,YAAY,CAAC,CAAC;KAC/C;IAYL,4BAAC;AAAD,CAAC,IAAA;AAED,IAAM,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;SAKnB,OAAO,CAAI,KAAgB;IACvC,IAAI,KAAK,EAAE;QACP,IAAM,KAAG,GAAG,KAAiB,CAAA;QACtB,IAAA,QAAQ,GAAI,KAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAxB,CAAyB;QACxC,IAAI,QAAQ,YAAY,KAAK,EAAE;YAC3B,MAAM,QAAQ,CAAC;SAClB;QACD,IAAM,MAAI,GAAG,QAAiC,CAAC;QAC/C,OAAO;YACH,GAAG,EAAE,cAAM,OAAA,MAAI,CAAC,UAAU,CAAC,KAAG,CAAC,IAAI,CAAC,GAAA;YACpC,QAAQ,EAAE,cAAM,OAAA,MAAI,CAAC,WAAW,CAAC,KAAG,CAAC,GAAA;YACrC,UAAU,EAAE,cAAM,OAAA,CAAC,MAAI,CAAC,WAAW,CAAC,KAAG,CAAC,GAAA;SAC3C,CAAA;KACJ;IACD,OAAO;QACH,EAAE,EAAE,QAAQ;QACZ,IAAI,EAAE,UAAC,KAA8B;YACjC,OAAO,IAAI,qBAAqB,CAAC,KAAK,CAAC,KAAK,CAAO,CAAA;SACtD;KACJ,CAAA;AACL;;;;"}