{"version":3,"file":"index.js","sources":["../src/Initial.ts"],"sourcesContent":["\nimport {\n    Path,\n    Downgraded,\n    Plugin,\n    StateValueAtPath,\n    StateValueAtRoot,\n    State,\n    self,\n    StateMethods\n} from '@hookstate/core';\n\nimport isEqual from 'lodash.isequal';\nimport cloneDeep from 'lodash.clonedeep';\n\nexport interface InitialExtensions<S> {\n    get(): S | undefined;\n    modified(): boolean;\n    unmodified(): boolean;\n}\n\nclass InitialPluginInstance {\n    private initialState: StateValueAtRoot;\n    constructor(initialValue: StateValueAtRoot) {\n        this.initialState = cloneDeep(initialValue);\n    }\n    getInitial = (path: Path) => {\n        let result = this.initialState;\n        path.forEach(p => {\n            result = result && result[p];\n        });\n        return result;\n    }\n    getModified = (l: StateMethods<StateValueAtPath>): boolean => {\n        l.attach(Downgraded)\n        return !isEqual(l.value, this.getInitial(l.path))\n    }\n}\n\nconst PluginID = Symbol('Initial');\n\n// tslint:disable-next-line: function-name\nexport function Initial(): Plugin;\nexport function Initial<S>($this: State<S>): InitialExtensions<S>;\nexport function Initial<S>($this?: State<S>): Plugin | InitialExtensions<S> {\n    if ($this) {\n        const $th = $this as State<S>\n        const [instance] = $th[self].attach(PluginID);\n        if (instance instanceof Error) {\n            throw instance;\n        }\n        const inst = instance as InitialPluginInstance;\n        return {\n            get: () => inst.getInitial($th[self].path),\n            modified: () => inst.getModified($th[self]),\n            unmodified: () => !inst.getModified($th[self])\n        }\n    }\n    return {\n        id: PluginID,\n        init: (state: State<StateValueAtRoot>) => {\n            return new InitialPluginInstance(state[self].value) as {}\n        }\n    }\n}\n"],"names":["Downgraded","self"],"mappings":";;;;;;;;;;AAqBA;IAEI,+BAAY,YAA8B;QAA1C,iBAEC;QACD,eAAU,GAAG,UAAC,IAAU;YACpB,IAAI,MAAM,GAAG,KAAI,CAAC,YAAY,CAAC;YAC/B,IAAI,CAAC,OAAO,CAAC,UAAA,CAAC;gBACV,MAAM,GAAG,MAAM,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC;aAChC,CAAC,CAAC;YACH,OAAO,MAAM,CAAC;SACjB,CAAA;QACD,gBAAW,GAAG,UAAC,CAAiC;YAC5C,CAAC,CAAC,MAAM,CAACA,eAAU,CAAC,CAAA;YACpB,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAA;SACpD,CAAA;QAZG,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC,YAAY,CAAC,CAAC;KAC/C;IAYL,4BAAC;AAAD,CAAC,IAAA;AAED,IAAM,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;SAKnB,OAAO,CAAI,KAAgB;IACvC,IAAI,KAAK,EAAE;QACP,IAAM,KAAG,GAAG,KAAiB,CAAA;QACtB,IAAA,QAAQ,GAAI,KAAG,CAACC,SAAI,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,GAA9B,CAA+B;QAC9C,IAAI,QAAQ,YAAY,KAAK,EAAE;YAC3B,MAAM,QAAQ,CAAC;SAClB;QACD,IAAM,MAAI,GAAG,QAAiC,CAAC;QAC/C,OAAO;YACH,GAAG,EAAE,cAAM,OAAA,MAAI,CAAC,UAAU,CAAC,KAAG,CAACA,SAAI,CAAC,CAAC,IAAI,CAAC,GAAA;YAC1C,QAAQ,EAAE,cAAM,OAAA,MAAI,CAAC,WAAW,CAAC,KAAG,CAACA,SAAI,CAAC,CAAC,GAAA;YAC3C,UAAU,EAAE,cAAM,OAAA,CAAC,MAAI,CAAC,WAAW,CAAC,KAAG,CAACA,SAAI,CAAC,CAAC,GAAA;SACjD,CAAA;KACJ;IACD,OAAO;QACH,EAAE,EAAE,QAAQ;QACZ,IAAI,EAAE,UAAC,KAA8B;YACjC,OAAO,IAAI,qBAAqB,CAAC,KAAK,CAACA,SAAI,CAAC,CAAC,KAAK,CAAO,CAAA;SAC5D;KACJ,CAAA;AACL;;;;"}