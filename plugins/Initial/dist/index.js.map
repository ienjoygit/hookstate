{"version":3,"file":"index.js","sources":["../src/Initial.ts"],"sourcesContent":["\r\nimport {\r\n    Path,\r\n    Downgraded,\r\n    Plugin,\r\n    StateValueAtPath,\r\n    StateValueAtRoot,\r\n    State,\r\n    StateMethods\r\n} from '@hookstate/core';\r\n\r\nimport isEqual from 'lodash.isequal';\r\nimport cloneDeep from 'lodash.clonedeep';\r\n\r\nexport interface InitialExtensions<S> {\r\n    get(): S | undefined;\r\n    modified(): boolean;\r\n    unmodified(): boolean;\r\n}\r\n\r\nclass InitialPluginInstance {\r\n    private initialState: StateValueAtRoot;\r\n    constructor(initialValue: StateValueAtRoot) {\r\n        this.initialState = cloneDeep(initialValue);\r\n    }\r\n    getInitial = (path: Path) => {\r\n        let result = this.initialState;\r\n        path.forEach(p => {\r\n            result = result && result[p];\r\n        });\r\n        return result;\r\n    }\r\n    getModified = (l: StateMethods<StateValueAtPath>): boolean => {\r\n        l.attach(Downgraded)\r\n        return !isEqual(l.value, this.getInitial(l.path))\r\n    }\r\n}\r\n\r\nconst PluginID = Symbol('Initial');\r\n\r\n// tslint:disable-next-line: function-name\r\nexport function Initial(): Plugin;\r\nexport function Initial<S>($this: State<S>): InitialExtensions<S>;\r\nexport function Initial<S>($this?: State<S>): Plugin | InitialExtensions<S> {\r\n    if ($this) {\r\n        const $th = $this as State<S>\r\n        const [instance] = $th.attach(PluginID);\r\n        if (instance instanceof Error) {\r\n            throw instance;\r\n        }\r\n        const inst = instance as InitialPluginInstance;\r\n        return {\r\n            get: () => inst.getInitial($th.path),\r\n            modified: () => inst.getModified($th),\r\n            unmodified: () => !inst.getModified($th)\r\n        }\r\n    }\r\n    return {\r\n        id: PluginID,\r\n        init: (state: State<StateValueAtRoot>) => {\r\n            return new InitialPluginInstance(state.value) as {}\r\n        }\r\n    }\r\n}\r\n"],"names":["Downgraded","isEqual","cloneDeep"],"mappings":";;;;;;;;;;;;;AAoBA,IAAA,qBAAA,kBAAA,YAAA;AAEI,IAAA,SAAA,qBAAA,CAAY,YAA8B,EAAA;QAA1C,IAEC,KAAA,GAAA,IAAA,CAAA;QACD,IAAU,CAAA,UAAA,GAAG,UAAC,IAAU,EAAA;AACpB,YAAA,IAAI,MAAM,GAAG,KAAI,CAAC,YAAY,CAAC;AAC/B,YAAA,IAAI,CAAC,OAAO,CAAC,UAAA,CAAC,EAAA;AACV,gBAAA,MAAM,GAAG,MAAM,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC;AACjC,aAAC,CAAC,CAAC;AACH,YAAA,OAAO,MAAM,CAAC;AAClB,SAAC,CAAA;QACD,IAAW,CAAA,WAAA,GAAG,UAAC,CAAiC,EAAA;AAC5C,YAAA,CAAC,CAAC,MAAM,CAACA,eAAU,CAAC,CAAA;AACpB,YAAA,OAAO,CAACC,2BAAO,CAAC,CAAC,CAAC,KAAK,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAA;AACrD,SAAC,CAAA;AAZG,QAAA,IAAI,CAAC,YAAY,GAAGC,6BAAS,CAAC,YAAY,CAAC,CAAC;KAC/C;IAYL,OAAC,qBAAA,CAAA;AAAD,CAAC,EAAA,CAAA,CAAA;AAED,IAAM,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;AAK7B,SAAU,OAAO,CAAI,KAAgB,EAAA;AACvC,IAAA,IAAI,KAAK,EAAE;QACP,IAAM,KAAG,GAAG,KAAiB,CAAA;QACtB,IAAA,QAAQ,GAAI,KAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAA,CAAA,CAAxB,CAAyB;QACxC,IAAI,QAAQ,YAAY,KAAK,EAAE;AAC3B,YAAA,MAAM,QAAQ,CAAC;AAClB,SAAA;QACD,IAAM,MAAI,GAAG,QAAiC,CAAC;QAC/C,OAAO;AACH,YAAA,GAAG,EAAE,YAAA,EAAM,OAAA,MAAI,CAAC,UAAU,CAAC,KAAG,CAAC,IAAI,CAAC,CAAA,EAAA;YACpC,QAAQ,EAAE,YAAM,EAAA,OAAA,MAAI,CAAC,WAAW,CAAC,KAAG,CAAC,CAAA,EAAA;YACrC,UAAU,EAAE,YAAM,EAAA,OAAA,CAAC,MAAI,CAAC,WAAW,CAAC,KAAG,CAAC,CAAA,EAAA;SAC3C,CAAA;AACJ,KAAA;IACD,OAAO;AACH,QAAA,EAAE,EAAE,QAAQ;QACZ,IAAI,EAAE,UAAC,KAA8B,EAAA;AACjC,YAAA,OAAO,IAAI,qBAAqB,CAAC,KAAK,CAAC,KAAK,CAAO,CAAA;SACtD;KACJ,CAAA;AACL;;;;"}