{"version":3,"file":"index.es.js","sources":["../src/Initial.ts"],"sourcesContent":["\nimport {\n    Path,\n    DisabledTracking,\n    Plugin,\n    PluginTypeMarker,\n    StateLink,\n    StateValueAtPath,\n    StateValueAtRoot\n} from '@hookstate/core';\n\nimport isEqual from 'lodash.isequal';\nimport cloneDeep from 'lodash.clonedeep';\n\nexport interface InitialExtensions {\n    // unfortunately, there is no way in typescript to\n    // express generic type parameter, which would change\n    // on the result of nested statelink call\n    readonly initial: StateValueAtPath | undefined;\n    readonly modified: boolean;\n    readonly unmodified: boolean;\n}\n\nconst PluginID = Symbol('Initial');\n\n// tslint:disable-next-line: function-name\nexport function Initial<S, E extends {}>(unused: PluginTypeMarker<S, E>): Plugin<E, InitialExtensions> {\n    return {\n        id: PluginID,\n        instanceFactory: (initialValue: StateValueAtRoot) => {\n            const initialState: StateValueAtRoot = cloneDeep(initialValue);\n            const getInitial = (path: Path) => {\n                let result = initialState;\n                path.forEach(p => {\n                    result = result && result[p];\n                });\n                return result;\n            }\n            const modified = (l: StateLink<StateValueAtPath, E>): boolean => {\n                l.with(DisabledTracking)\n                return !isEqual(l.value, getInitial(l.path))\n            }\n            return {\n                extensions: ['initial', 'modified', 'unmodified'],\n                extensionsFactory: (l) => ({\n                    get initial() {\n                        return getInitial(l.path)\n                    },\n                    get modified() {\n                        return modified(l);\n                    },\n                    get unmodified() {\n                        return !modified(l)\n                    },\n                })\n            }\n        }\n    }\n}\n"],"names":[],"mappings":";;;;AAuBA,IAAM,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;;AAGnC,SAAgB,OAAO,CAAkB,MAA8B;IACnE,OAAO;QACH,EAAE,EAAE,QAAQ;QACZ,eAAe,EAAE,UAAC,YAA8B;YAC5C,IAAM,YAAY,GAAqB,SAAS,CAAC,YAAY,CAAC,CAAC;YAC/D,IAAM,UAAU,GAAG,UAAC,IAAU;gBAC1B,IAAI,MAAM,GAAG,YAAY,CAAC;gBAC1B,IAAI,CAAC,OAAO,CAAC,UAAA,CAAC;oBACV,MAAM,GAAG,MAAM,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC;iBAChC,CAAC,CAAC;gBACH,OAAO,MAAM,CAAC;aACjB,CAAA;YACD,IAAM,QAAQ,GAAG,UAAC,CAAiC;gBAC/C,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAA;gBACxB,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAA;aAC/C,CAAA;YACD,OAAO;gBACH,UAAU,EAAE,CAAC,SAAS,EAAE,UAAU,EAAE,YAAY,CAAC;gBACjD,iBAAiB,EAAE,UAAC,CAAC,IAAK,QAAC;oBACvB,IAAI,OAAO;wBACP,OAAO,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;qBAC5B;oBACD,IAAI,QAAQ;wBACR,OAAO,QAAQ,CAAC,CAAC,CAAC,CAAC;qBACtB;oBACD,IAAI,UAAU;wBACV,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAA;qBACtB;iBACJ,IAAC;aACL,CAAA;SACJ;KACJ,CAAA;CACJ;;;;"}