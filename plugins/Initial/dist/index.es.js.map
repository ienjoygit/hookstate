{"version":3,"file":"index.es.js","sources":["../src/Initial.ts"],"sourcesContent":["\nimport {\n    Path,\n    Downgraded,\n    Plugin,\n    StateLink,\n    StateValueAtPath,\n    StateValueAtRoot\n} from '@hookstate/core';\n\nimport isEqual from 'lodash.isequal';\nimport cloneDeep from 'lodash.clonedeep';\n\nexport interface InitialExtensions<S> {\n    get(): S | undefined;\n    modified(): boolean;\n    unmodified(): boolean;\n}\n\nclass InitialPluginInstance {\n    private initialState: StateValueAtRoot;\n    constructor(initialValue: StateValueAtRoot) {\n        this.initialState = cloneDeep(initialValue);\n    }\n    getInitial = (path: Path) => {\n        let result = this.initialState;\n        path.forEach(p => {\n            result = result && result[p];\n        });\n        return result;\n    }\n    getModified = (l: StateLink<StateValueAtPath>): boolean => {\n        l.with(Downgraded)\n        return !isEqual(l.value, this.getInitial(l.path))\n    }\n}\n\nconst PluginID = Symbol('Initial');\n\n// tslint:disable-next-line: function-name\nexport function Initial(): Plugin;\nexport function Initial<S>(self: StateLink<S>): InitialExtensions<S>;\nexport function Initial<S>(self?: StateLink<S>): Plugin | InitialExtensions<S> {\n    if (self) {\n        const [link, instance] = self.with(PluginID);\n        const inst = instance as InitialPluginInstance;\n        return {\n            get: () => inst.getInitial(link.path),\n            modified: () => inst.getModified(link),\n            unmodified: () => !inst.getModified(link)\n        }\n    }\n    return {\n        id: PluginID,\n        create: (state: StateLink<StateValueAtRoot>) => {\n            return new InitialPluginInstance(state.value) as {}\n        }\n    }\n}\n"],"names":[],"mappings":";;;;AAmBA;IAEI,+BAAY,YAA8B;QAA1C,iBAEC;QACD,eAAU,GAAG,UAAC,IAAU;YACpB,IAAI,MAAM,GAAG,KAAI,CAAC,YAAY,CAAC;YAC/B,IAAI,CAAC,OAAO,CAAC,UAAA,CAAC;gBACV,MAAM,GAAG,MAAM,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC;aAChC,CAAC,CAAC;YACH,OAAO,MAAM,CAAC;SACjB,CAAA;QACD,gBAAW,GAAG,UAAC,CAA8B;YACzC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;YAClB,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAA;SACpD,CAAA;QAZG,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC,YAAY,CAAC,CAAC;KAC/C;IAYL,4BAAC;AAAD,CAAC,IAAA;AAED,IAAM,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;SAKnB,OAAO,CAAI,IAAmB;IAC1C,IAAI,IAAI,EAAE;QACA,IAAA,wBAAsC,EAArC,cAAI,EAAE,gBAA+B,CAAC;QAC7C,IAAM,MAAI,GAAG,QAAiC,CAAC;QAC/C,OAAO;YACH,GAAG,EAAE,cAAM,OAAA,MAAI,CAAC,UAAU,CAAC,MAAI,CAAC,IAAI,CAAC,GAAA;YACrC,QAAQ,EAAE,cAAM,OAAA,MAAI,CAAC,WAAW,CAAC,MAAI,CAAC,GAAA;YACtC,UAAU,EAAE,cAAM,OAAA,CAAC,MAAI,CAAC,WAAW,CAAC,MAAI,CAAC,GAAA;SAC5C,CAAA;KACJ;IACD,OAAO;QACH,EAAE,EAAE,QAAQ;QACZ,MAAM,EAAE,UAAC,KAAkC;YACvC,OAAO,IAAI,qBAAqB,CAAC,KAAK,CAAC,KAAK,CAAO,CAAA;SACtD;KACJ,CAAA;AACL;;;;"}