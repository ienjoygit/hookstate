{"version":3,"file":"index.js","sources":["../src/Persistence.ts"],"sourcesContent":["\nimport { Plugin, StateValueAtRoot } from '@hookstate/core';\n\nconst PluginID = Symbol('LocalPersistence');\n\n// tslint:disable-next-line: function-name\nexport function Persistence(localStorageKey: string): (() => Plugin) {\n    return () => {\n        return {\n            id: PluginID,\n            instanceFactory: (initial: StateValueAtRoot) => {\n                return {\n                    onInit: () => {\n                        const persisted = localStorage.getItem(localStorageKey);\n                        if (persisted !== null) {\n                            const result = JSON.parse(persisted);\n                            return result;\n                        }\n                        localStorage.setItem(localStorageKey, JSON.stringify(initial))\n                        return initial;\n                    },\n                    onSet: (p, v) => {\n                        localStorage.setItem(localStorageKey, JSON.stringify(v));\n                    }\n                }\n            }\n        }\n    }\n}\n"],"names":[],"mappings":";;;;AAGA,IAAM,QAAQ,GAAG,MAAM,CAAC,kBAAkB,CAAC,CAAC;;AAG5C,SAAgB,WAAW,CAAC,eAAuB;IAC/C,OAAO;QACH,OAAO;YACH,EAAE,EAAE,QAAQ;YACZ,eAAe,EAAE,UAAC,OAAyB;gBACvC,OAAO;oBACH,MAAM,EAAE;wBACJ,IAAM,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;wBACxD,IAAI,SAAS,KAAK,IAAI,EAAE;4BACpB,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;4BACrC,OAAO,MAAM,CAAC;yBACjB;wBACD,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAA;wBAC9D,OAAO,OAAO,CAAC;qBAClB;oBACD,KAAK,EAAE,UAAC,CAAC,EAAE,CAAC;wBACR,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;qBAC5D;iBACJ,CAAA;aACJ;SACJ,CAAA;KACJ,CAAA;CACJ;;;;"}