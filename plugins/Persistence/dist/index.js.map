{"version":3,"file":"index.js","sources":["../src/Persistence.ts"],"sourcesContent":["import { Plugin, StateValueAtRoot, PluginCallbacks, State } from '@hookstate/core';\n\nconst PluginID = Symbol('LocalPersistence');\n\n// tslint:disable-next-line: function-name\nexport function Persistence(localStorageKey: string): (() => Plugin) {\n    return () => ({\n        id: PluginID,\n        init: (state: State<StateValueAtRoot>) => {\n            const persisted = localStorage.getItem(localStorageKey);\n            if (persisted !== null) {\n                const result = JSON.parse(persisted);\n                state.set(result);\n            } else if (!state.promised && !!!state.error) {\n                localStorage.setItem(localStorageKey, JSON.stringify(state.value))\n            }\n            return {\n                onSet: (p) => {\n                    if ('state' in p) {\n                        localStorage.setItem(localStorageKey, JSON.stringify(p.state));\n                    } else {\n                        localStorage.removeItem(localStorageKey)\n                    }\n                }\n            } as PluginCallbacks\n        }\n    })\n}\n"],"names":[],"mappings":";;;;AAEA,IAAM,QAAQ,GAAG,MAAM,CAAC,kBAAkB,CAAC,CAAC;AAE5C;SACgB,WAAW,CAAC,eAAuB;IAC/C,OAAO,cAAM,QAAC;QACV,EAAE,EAAE,QAAQ;QACZ,IAAI,EAAE,UAAC,KAA8B;YACjC,IAAM,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YACxD,IAAI,SAAS,KAAK,IAAI,EAAE;gBACpB,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;gBACrC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;aACrB;iBAAM,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE;gBAC1C,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;aACrE;YACD,OAAO;gBACH,KAAK,EAAE,UAAC,CAAC;oBACL,IAAI,OAAO,IAAI,CAAC,EAAE;wBACd,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;qBAClE;yBAAM;wBACH,YAAY,CAAC,UAAU,CAAC,eAAe,CAAC,CAAA;qBAC3C;iBACJ;aACe,CAAA;SACvB;KACJ,IAAC,CAAA;AACN;;;;"}