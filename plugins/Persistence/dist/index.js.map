{"version":3,"file":"index.js","sources":["../src/Persistence.ts"],"sourcesContent":["import { Plugin, StateValueAtRoot, PluginCallbacks, State } from '@hookstate/core';\r\n\r\nconst PluginID = Symbol('LocalPersistence');\r\n\r\n// tslint:disable-next-line: function-name\r\nexport function Persistence(localStorageKey: string): (() => Plugin) {\r\n    return () => ({\r\n        id: PluginID,\r\n        init: (state: State<StateValueAtRoot>) => {\r\n            const persisted = localStorage.getItem(localStorageKey);\r\n            if (persisted !== null) {\r\n                const result = JSON.parse(persisted);\r\n                state.set(result);\r\n            } else if (!state.promised && !!!state.error) {\r\n                localStorage.setItem(localStorageKey, JSON.stringify(state.value))\r\n            }\r\n            return {\r\n                onSet: (p) => {\r\n                    if ('state' in p) {\r\n                        localStorage.setItem(localStorageKey, JSON.stringify(p.state));\r\n                    } else {\r\n                        localStorage.removeItem(localStorageKey)\r\n                    }\r\n                }\r\n            } as PluginCallbacks\r\n        }\r\n    })\r\n}\r\n"],"names":[],"mappings":";;;;AAEA,IAAM,QAAQ,GAAG,MAAM,CAAC,kBAAkB,CAAC,CAAC;AAE5C;SACgB,WAAW,CAAC,eAAuB;IAC/C,OAAO,cAAM,QAAC;QACV,EAAE,EAAE,QAAQ;QACZ,IAAI,EAAE,UAAC,KAA8B;YACjC,IAAM,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YACxD,IAAI,SAAS,KAAK,IAAI,EAAE;gBACpB,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;gBACrC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;aACrB;iBAAM,IAAI,CAAC,KAAK,CAAC,QAAQ,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,EAAE;gBAC1C,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;aACrE;YACD,OAAO;gBACH,KAAK,EAAE,UAAC,CAAC;oBACL,IAAI,OAAO,IAAI,CAAC,EAAE;wBACd,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;qBAClE;yBAAM;wBACH,YAAY,CAAC,UAAU,CAAC,eAAe,CAAC,CAAA;qBAC3C;iBACJ;aACe,CAAA;SACvB;KACJ,IAAC,CAAA;AACN;;;;"}