{"version":3,"file":"index.es.js","sources":["../node_modules/tslib/tslib.es6.js","../src/UseStateLink.tsx"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import React from 'react';\n\n//\n// DECLARATIONS\n//\n\nexport interface PluginTypeMarker<S, E extends {}> { }\n\nexport interface StateRef<S, E extends {}> {\n    with<I>(plugin: (marker: PluginTypeMarker<S, E>) => Plugin<E, I>): StateRef<S, E & I>;\n}\n\n// TODO add support for Map and Set\nexport type NestedInferredLink<S, E extends {}> =\n    S extends ReadonlyArray<(infer U)> ? ReadonlyArray<StateLink<U, E>> :\n    S extends null ? undefined :\n    S extends object ? { readonly [K in keyof Required<S>]: StateLink<S[K], E>; } :\n    undefined;\n\nexport type Path = ReadonlyArray<string | number>;\n\nexport interface StateLink<S, E extends {} = {}> {\n    readonly path: Path;\n    readonly value: S;\n\n    readonly nested: NestedInferredLink<S, E>;\n    readonly extended: E;\n\n    set(newValue: React.SetStateAction<S>): void;\n    with<I>(plugin: (marker: PluginTypeMarker<S, E>) => Plugin<E, I>): StateLink<S, E & I>;\n}\n// keep temporary for backward compatibility with the previous version\nexport type ValueLink<S, E extends {} = {}> = StateLink<S, E>;\n\n// type alias to highlight the places where we are dealing with root state value\n// tslint:disable-next-line: no-any\nexport type StateValueAtRoot = any;\n// tslint:disable-next-line: no-any\nexport type StateValueAtPath = any;\n// tslint:disable-next-line: no-any\nexport type TransformResult = any;\n\nexport interface PluginInstance<E extends {}, I extends {}> {\n    // if returns defined value,\n    // it overrides the current / initial value in the state\n    // it is only applicable for plugins attached via stateref, not via statelink\n    onInit?: () => StateValueAtRoot | void,\n    onAttach?: (path: Path, withArgument: PluginInstance<{}, {}>) => void,\n    onSet?: (path: Path, newValue: StateValueAtRoot) => void,\n\n    extensions: (keyof I)[],\n    // thisLink can be anything, not only root link with value of type S\n    extensionsFactory: (thisLink: StateLink<StateValueAtPath, E>) => I\n};\n\nexport interface Plugin<E extends {}, I extends {}> {\n    id: symbol;\n    // initial value may not be of the same type as the target value type,\n    // because it is coming from the state and represents the type of the root value\n    instanceFactory: (initial: StateValueAtRoot) => PluginInstance<E, I>;\n}\n\n//\n// INTERNAL IMPLEMENTATIONS\n//\n\nclass StateLinkInvalidUsageError extends Error {\n    constructor(op: string, path: Path) {\n        super(`StateLink is used incorrectly. Attempted '${op}' at '/${path.join('/')}'`)\n    }\n}\n\nclass ExtensionInvalidUsageError extends Error {\n    constructor(op: string, path: Path) {\n        super(`Extension is used incorrectly. Attempted '${op}' at '/${path.join('/')}'`)\n    }\n}\n\nclass ExtensionInvalidRegistrationError extends Error {\n    constructor(id: symbol, path: Path) {\n        super(`Extension with onInit, which overrides initial value, ` +\n        `should be attached to StateRef instance, but not to StateLink instance. ` +\n        `Attempted 'with ${id.toString()}' at '/${path.join('/')}'`)\n    }\n}\n\nclass ExtensionConflictRegistrationError extends Error {\n    constructor(newId: symbol, existingId: symbol, ext: string) {\n        super(`Extension '${ext}' is already registered for '${existingId.toString()}'. ` +\n        `Attempted 'with ${newId.toString()}''`)\n    }\n}\n\nclass ExtensionUnknownError extends Error {\n    constructor(ext: string) {\n        super(`Extension '${ext}' is unknown'`)\n    }\n}\n\ninterface Subscriber {\n    onSet(path: Path, actions: (() => void)[]): void;\n}\n\ninterface Subscribable {\n    subscribe(l: Subscriber): void;\n    unsubscribe(l: Subscriber): void;\n}\n\nconst DisabledTrackingID = Symbol('DisabledTracking');\nconst PrerenderID = Symbol('Prerender');\n\nconst HiddenPluginId = Symbol('PluginID');\nconst RootPath: Path = [];\n\nclass State implements Subscribable {\n    private _subscribers: Set<Subscriber> = new Set();\n\n    private _extensions: Record<string, PluginInstance<{}, {}>> = {};\n    private _plugins: Map<symbol, PluginInstance<{}, {}>> = new Map();\n\n    constructor(private _value: StateValueAtRoot) { }\n\n    get(path: Path) {\n        let result = this._value;\n        path.forEach(p => {\n            result = result[p];\n        });\n        return result;\n    }\n\n    set(path: Path, value: StateValueAtPath) {\n        if (path.length === 0) {\n            this._value = value;\n        }\n        let result = this._value;\n        path.forEach((p, i) => {\n            if (i === path.length - 1) {\n                if (!(p in result)) {\n                    // if an array of object is about to be extended by new property\n                    // we consider it is the whole object is changed\n                    // which is identified by upper path\n                    path = path.slice(0, -1)\n                }\n                result[p] = value;\n            } else {\n                result = result[p];\n            }\n        });\n        const actions: (() => void)[] = [];\n        this._subscribers.forEach(s => s.onSet(path, actions));\n        actions.forEach(a => a());\n    }\n\n    extensions() {\n        return this._extensions;\n    }\n\n    register(plugin: Plugin<{}, {}>, path?: Path | undefined) {\n        const existingInstance = this._plugins.get(plugin.id)\n        if (existingInstance) {\n            if (existingInstance.onAttach) {\n                existingInstance.onAttach(path || RootPath, plugin.instanceFactory(this._value))\n            }\n            return;\n        }\n        const pluginInstance = plugin.instanceFactory(this._value);\n        this._plugins.set(plugin.id, pluginInstance);\n        if (pluginInstance.onInit) {\n            const initValue = pluginInstance.onInit()\n            if (initValue !== undefined) {\n                if (path) {\n                    throw new ExtensionInvalidRegistrationError(plugin.id, path);\n                }\n                this._value = initValue;\n            }\n        }\n        if (pluginInstance.onAttach) {\n            pluginInstance.onAttach(path || RootPath, pluginInstance)\n        }\n        const extensions = pluginInstance.extensions;\n        extensions.forEach(e => {\n            if (e in this._extensions) {\n                throw new ExtensionConflictRegistrationError(\n                    plugin.id,\n                    this._extensions[e as string][HiddenPluginId],\n                    e as string);\n            }\n            pluginInstance[HiddenPluginId] = plugin.id;\n            this._extensions[e as string] = pluginInstance;\n        });\n        if (pluginInstance.onSet) {\n            const onSet = pluginInstance.onSet;\n            this.subscribe({\n                onSet: (p) => onSet(p, this._value)\n            })\n        }\n        return;\n    }\n\n    subscribe(l: Subscriber) {\n        this._subscribers.add(l);\n    }\n\n    unsubscribe(l: Subscriber) {\n        this._subscribers.delete(l);\n    }\n}\n\nclass StateRefImpl<S, E extends {}> implements StateRef<S, E> {\n    public disabledTracking: boolean | undefined;\n\n    constructor(public state: State) { }\n\n    with<I extends {}>(plugin: (marker: PluginTypeMarker<S, E>) => Plugin<E, I>): StateRef<S, E & I> {\n        const pluginMeta = plugin({})\n        if (pluginMeta.id === DisabledTrackingID) {\n            this.disabledTracking = true;\n            return this as unknown as StateRef<S, E & I>;\n        }\n        this.state.register(pluginMeta as unknown as Plugin<{}, {}>);\n        return this as unknown as StateRef<S, E & I>;\n    }\n}\n\nclass StateLinkImpl<S, E extends {}> implements StateLink<S, E>, Subscribable, Subscriber {\n    public disabledTracking: boolean | undefined;\n    private subscribers: Set<Subscriber> | undefined;\n\n    private nestedCache: NestedInferredLink<S, E> | undefined;\n    private nestedLinksCache: Record<string | number, StateLinkImpl<S[keyof S], E>> | undefined;\n\n    private valueTracked: S | undefined;\n    private valueUsed: boolean | undefined;\n\n    constructor(\n        public readonly state: State,\n        public readonly path: Path,\n        public onUpdateUsed: () => void,\n        public valueUntracked: S\n    ) { }\n\n    get value(): S {\n        if (this.valueTracked === undefined) {\n            if (this.disabledTracking) {\n                this.valueTracked = this.valueUntracked;\n                if (this.valueTracked === undefined) {\n                    this.valueUsed = true;\n                }\n            } else if (Array.isArray(this.valueUntracked)) {\n                this.valueTracked = this.valueArrayImpl();\n            } else if (typeof this.valueUntracked === 'object' && this.valueUntracked !== null) {\n                this.valueTracked = this.valueObjectImpl();\n            } else {\n                this.valueTracked = this.valueUntracked;\n                if (this.valueTracked === undefined) {\n                    this.valueUsed = true;\n                }\n            }\n        }\n        return this.valueTracked!;\n    }\n\n    set(newValue: React.SetStateAction<S>): void {\n        // inferred() function checks for the nullability of the current value:\n        // If value is not null | undefined, it resolves to ArrayLink or ObjectLink\n        // which can not take null | undefined as a value.\n        // However, it is possible that a user of this ValueLink\n        // may call set(null | undefined).\n        // In this case this null will leak via setValue(prevValue => ...)\n        // to mutation actions for array or object,\n        // which breaks the guarantee of ArrayStateMutation and ObjectStateMutation to not link nullable value.\n        // Currently this causes a crash within ObjectStateMutation or ArrayStateMutation mutation actions.\n        // This behavior is left intentionally to make it equivivalent to the following:\n        // Example (plain JS):\n        //    let myvar: { a: string, b: string } = { a: '', b: '' }\n        //    myvar = undefined;\n        //    myvar.a = '' // <-- crash here\n        //    myvar = { a: '', b: '' } // <-- OK\n        // Example (using value links):\n        //    let myvar = useStateLink({ a: '', b: '' } as { a: string, b: string } | undefined);\n        //    let myvar_a = myvar.nested.a; // get value link to a property\n        //    myvar.set(undefined);\n        //    myvar_a.set('') // <-- crash here\n        //    myvar.set({ a: '', b: '' }) // <-- OK\n        if (typeof newValue === 'function') {\n            newValue = (newValue as ((prevValue: S) => S))(this.state.get(this.path));\n        }\n        this.state.set(this.path, newValue);\n    }\n\n    with<I>(plugin: (marker: PluginTypeMarker<S, E>) => Plugin<E, I>): StateLink<S, E & I> {\n        const pluginMeta = plugin({});\n        if (pluginMeta.id === DisabledTrackingID) {\n            this.disabledTracking = true;\n            return this as unknown as StateLink<S, E & I>;\n        }\n        this.state.register(pluginMeta as unknown as Plugin<{}, {}>, this.path);\n        return this as unknown as StateLink<S, E & I>;\n    }\n\n    get extended() {\n        const getter = (target: Record<string, PluginInstance<{}, {}>>, key: PropertyKey) => {\n            if (typeof key === 'symbol') {\n                return undefined;\n            }\n            const plugin = target[key];\n            if (plugin === undefined) {\n                throw new ExtensionUnknownError(key.toString());\n            }\n            // tslint:disable-next-line: no-any\n            const extension: any = plugin.extensionsFactory(this)[key];\n            if (extension === undefined) {\n                throw new ExtensionUnknownError(key.toString());\n            }\n            return extension;\n        };\n        return this.proxyWrap(this.state.extensions(), getter, o => {\n            throw new ExtensionInvalidUsageError(o, this.path)\n        });\n    }\n\n    subscribe(l: Subscriber) {\n        if (this.subscribers === undefined) {\n            this.subscribers = new Set();\n        }\n        this.subscribers.add(l);\n    }\n\n    unsubscribe(l: Subscriber) {\n        this.subscribers!.delete(l);\n    }\n\n    onSet(path: Path, actions: (() => void)[]) {\n        this.updateIfUsed(path, actions)\n    }\n\n    updateIfUsed(path: Path, actions: (() => void)[]): boolean {\n        const update = () => {\n            if (this.disabledTracking && (this.valueTracked !== undefined || this.valueUsed === true)) {\n                actions.push(this.onUpdateUsed);\n                return true;\n            }\n            const firstChildKey = path[this.path.length];\n            if (firstChildKey === undefined) {\n                if (this.valueTracked !== undefined || this.valueUsed === true) {\n                    actions.push(this.onUpdateUsed);\n                    return true;\n                }\n                return false;\n            }\n            const firstChildValue = this.nestedLinksCache && this.nestedLinksCache[firstChildKey];\n            if (firstChildValue === undefined) {\n                return false;\n            }\n            return firstChildValue.updateIfUsed(path, actions);\n        }\n\n        const updated = update();\n        if (!updated && this.subscribers !== undefined) {\n            this.subscribers.forEach(s => {\n                s.onSet(path, actions)\n            })\n        }\n        return updated;\n    }\n\n    get nested(): NestedInferredLink<S, E> {\n        if (!this.valueTracked) {\n            this.valueUsed = true;\n        }\n        if (this.nestedCache === undefined) {\n            if (Array.isArray(this.valueUntracked)) {\n                this.nestedCache = this.nestedArrayImpl();\n            } else if (typeof this.valueUntracked === 'object' && this.valueUntracked !== null) {\n                this.nestedCache = this.nestedObjectImpl();\n            } else {\n                this.nestedCache = undefined;\n            }\n        }\n        return this.nestedCache as NestedInferredLink<S, E>;\n    }\n\n    private nestedArrayImpl(): NestedInferredLink<S, E> {\n        const proxyGetterCache = {};\n        this.nestedLinksCache = proxyGetterCache;\n\n        const getter = (target: object, key: PropertyKey) => {\n            if (key === 'length') {\n                return (target as []).length;\n            }\n            if (key in Array.prototype) {\n                return Array.prototype[key];\n            }\n            const index = Number(key);\n            if (!Number.isInteger(index)) {\n                return undefined;\n            }\n            const cachehit = proxyGetterCache[index];\n            if (cachehit) {\n                return cachehit;\n            }\n            const r = new StateLinkImpl(\n                this.state,\n                this.path.slice().concat(index),\n                this.onUpdateUsed,\n                target[index]\n            )\n            if (this.disabledTracking) {\n                r.disabledTracking = true;\n            }\n            proxyGetterCache[index] = r;\n            return r;\n        };\n        return this.proxyWrap(this.valueUntracked as unknown as object, getter, o => {\n            throw new StateLinkInvalidUsageError(o, this.path)\n        }) as unknown as NestedInferredLink<S, E>;\n    }\n\n    private valueArrayImpl(): S {\n        const getter = (target: object, key: PropertyKey) => {\n            if (key === 'length') {\n                return (target as []).length;\n            }\n            if (key in Array.prototype) {\n                return Array.prototype[key];\n            }\n            const index = Number(key);\n            if (!Number.isInteger(index)) {\n                return undefined;\n            }\n            return (this.nested)![index].value;\n        };\n        return this.proxyWrap(this.valueUntracked as unknown as object, getter, o => {\n            throw new StateLinkInvalidUsageError(o, this.path)\n        }) as unknown as S;\n    }\n\n    private nestedObjectImpl(): NestedInferredLink<S, E> {\n        const proxyGetterCache = {}\n        this.nestedLinksCache = proxyGetterCache;\n\n        const getter = (target: object, key: PropertyKey) => {\n            if (typeof key === 'symbol') {\n                return undefined;\n            }\n            const cachehit = proxyGetterCache[key];\n            if (cachehit) {\n                return cachehit;\n            }\n            const r = new StateLinkImpl(\n                this.state,\n                this.path.slice().concat(key.toString()),\n                this.onUpdateUsed,\n                target[key]\n            );\n            if (this.disabledTracking) {\n                r.disabledTracking = true;\n            }\n            proxyGetterCache[key] = r;\n            return r;\n        };\n        return this.proxyWrap(this.valueUntracked as unknown as object, getter, o => {\n            throw new StateLinkInvalidUsageError(o, this.path)\n        }) as unknown as NestedInferredLink<S, E>;\n    }\n\n    private valueObjectImpl(): S {\n        const getter = (target: object, key: PropertyKey) => {\n            if (typeof key === 'symbol') {\n                return undefined;\n            }\n            return (this.nested)![key].value;\n        };\n        return this.proxyWrap(this.valueUntracked as unknown as object, getter, o => {\n            throw new StateLinkInvalidUsageError(o, this.path)\n        }) as unknown as S;\n    }\n\n    // tslint:disable-next-line: no-any\n    private proxyWrap(objectToWrap: any, getter: (target: any, key: PropertyKey) => any,\n        onInvalidUsage: (op: string) => never\n    ) {\n        return new Proxy(objectToWrap, {\n            getPrototypeOf: (target) => {\n                return Object.getPrototypeOf(target);\n            },\n            setPrototypeOf: (target, v) => {\n                return onInvalidUsage('setPrototypeOf')\n            },\n            isExtensible: (target) => {\n                return false;\n            },\n            preventExtensions: (target) => {\n                return onInvalidUsage('preventExtensions')\n            },\n            getOwnPropertyDescriptor: (target, p) => {\n                const origin = Object.getOwnPropertyDescriptor(target, p);\n                if (origin && Array.isArray(target) && p in Array.prototype) {\n                    return origin;\n                }\n                return origin && {\n                    configurable: true, // JSON.stringify() does not work for an object without it\n                    enumerable: origin.enumerable,\n                    get: () => getter(target as object, p),\n                    set: undefined\n                };\n            },\n            has: (target, p) => {\n                if (typeof p === 'symbol') {\n                    return false;\n                }\n                return p in target;\n            },\n            get: getter,\n            set: (target, p, value, receiver) => {\n                return onInvalidUsage('set')\n            },\n            deleteProperty: (target, p) => {\n                return onInvalidUsage('deleteProperty')\n            },\n            defineProperty: (target, p, attributes) => {\n                return onInvalidUsage('defineProperty')\n            },\n            enumerate: (target) => {\n                if (Array.isArray(target)) {\n                    return Object.keys(target).concat('length');\n                }\n                return Object.keys(target);\n            },\n            ownKeys: (target) => {\n                if (Array.isArray(target)) {\n                    return Object.keys(target).concat('length');\n                }\n                return Object.keys(target);\n            },\n            apply: (target, thisArg, argArray?) => {\n                return onInvalidUsage('apply')\n            },\n            construct: (target, argArray, newTarget?) => {\n                return onInvalidUsage('construct')\n            }\n        });\n    }\n}\n\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\n\nfunction createState<S>(initial: S | (() => S)): State {\n    let initialValue: S = initial as S;\n    if (typeof initial === 'function') {\n        initialValue = (initial as (() => S))();\n    }\n    return new State(initialValue);\n}\n\nfunction useSubscribedStateLink<S, E extends {}>(\n    state: State,\n    path: Path, update: () => void,\n    subscribeTarget: Subscribable,\n    disabledTracking?: boolean | undefined\n) {\n    const link = new StateLinkImpl<S, E>(\n        state,\n        path,\n        update,\n        state.get(path)\n    );\n    if (disabledTracking) {\n        link.with(DisabledTracking)\n    }\n    useIsomorphicLayoutEffect(() => {\n        subscribeTarget.subscribe(link);\n        return () => subscribeTarget.unsubscribe(link);\n    });\n    return link;\n}\n\nfunction useGlobalStateLink<S, E>(stateLink: StateRefImpl<S, E>): StateLinkImpl<S, E> {\n    const [, setValue] = React.useState({});\n    return useSubscribedStateLink(stateLink.state, RootPath, () => {\n        setValue({})\n    }, stateLink.state, stateLink.disabledTracking);\n}\n\nfunction useLocalStateLink<S>(initialState: S | (() => S)): StateLinkImpl<S, {}> {\n    const [value, setValue] = React.useState(() => ({ state: createState(initialState) }));\n    return useSubscribedStateLink(value.state, RootPath, () => {\n        setValue({ state: value.state })\n    }, value.state);\n}\n\nfunction useDerivedStateLink<S, E extends {}>(originLink: StateLinkImpl<S, E>): StateLinkImpl<S, E> {\n    const [, setValue] = React.useState({});\n    return useSubscribedStateLink(originLink.state, originLink.path, () => {\n        setValue({})\n    }, originLink, originLink.disabledTracking);\n    // note PrerenderTransform strategy is not inherited intentionally\n}\n\nfunction useAutoStateLink<S, E extends {}>(\n    initialState: S | (() => S) | StateLink<S, E> | StateRef<S, E>\n): StateLinkImpl<S, E> {\n    if (initialState instanceof StateLinkImpl) {\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        return useDerivedStateLink(initialState as StateLinkImpl<S, E>);\n    }\n    if (initialState instanceof StateRefImpl) {\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        return useGlobalStateLink(initialState as StateRefImpl<S, E>);\n    }\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    return useLocalStateLink(initialState as S | (() => S)) as StateLinkImpl<S, E>;\n}\n\nfunction injectTransform<S, E extends {}, R>(\n    link: StateLinkImpl<S, E>,\n    transform: (state: StateLink<S, E>, prev: R | undefined) => R\n) {\n    let injectedOnUpdateUsed: (() => void) | undefined = undefined;\n    const originOnUpdateUsed = link.onUpdateUsed;\n    link.onUpdateUsed = () => {\n        if (injectedOnUpdateUsed) {\n            return injectedOnUpdateUsed();\n        }\n        return originOnUpdateUsed();\n    }\n\n    const result = transform(link, undefined);\n    const prerenderEquals: ((a: R, b: R) => boolean) | undefined = link[PrerenderID];\n    if (prerenderEquals === undefined) {\n        return result;\n    }\n\n    injectedOnUpdateUsed = () => {\n        // need to create new one to make sure\n        // it does not pickup the stale cache of the original link after mutation\n        const overidingLink = new StateLinkImpl<S, E>(\n            link.state,\n            link.path,\n            link.onUpdateUsed,\n            link.state.get(link.path)\n        )\n        // and we should inject to onUpdate now\n        // so the overriding link is used to track used properties\n        link.onSet = (s, p) => overidingLink.onSet(s, p);\n        const updatedResult = transform(overidingLink, result);\n        // if result is not changed, it does not affect the rendering result too\n        // so, we skip triggering rerendering in this case\n        if (!prerenderEquals(updatedResult, result)) {\n            originOnUpdateUsed();\n        }\n    }\n    return result;\n}\n\n///\n/// EXPORTED IMPLEMENTATIONS\n///\n\nexport function createStateLink<S>(initial: S | (() => S)): StateRef<S, {}> {\n    return new StateRefImpl(createState(initial));\n}\n\n/*\n * Future docs for transformer\n * Forces rerender of a hooked component when result of `watcher`\n * is changed due to the change of the current value in `state`.\n * Change of the result is determined by the default tripple equality operator.\n * @param state state to watch for\n * @param watcher state-to-result redusing function. The second argument `prev` is\n * defined only when the `watcher` is invokded in reaction event after state is updated.\n * If the watcher returns the same value as the `prev`, the rerendering is not forced\n * by the watcher.\n */\n\nexport function useStateLink<S, E extends {}>(\n    initialState: StateLink<S, E> | StateRef<S, E>\n): StateLink<S, E>;\nexport function useStateLink<S, E extends {}, R>(\n    initialState: StateLink<S, E> | StateRef<S, E>,\n    transform: (state: StateLink<S, E>, prev: R | undefined) => R\n): R;\nexport function useStateLink<S>(\n    initialState: S | (() => S)\n): StateLink<S>;\nexport function useStateLink<S, R>(\n    initialState: S | (() => S),\n    transform: (state: StateLink<S>, prev: R | undefined) => R\n): R;\nexport function useStateLink<S, E extends {}, R>(\n    initialState: S | (() => S) | StateLink<S, E> | StateRef<S, E>,\n    transform?: (state: StateLink<S, E>, prev: R | undefined) => R\n): R {\n    const link = useAutoStateLink(initialState);\n    if (transform) {\n        return injectTransform(link, transform);\n    }\n    return link as unknown as R;\n}\n\nexport function useStateLinkUnmounted<S, E extends {}>(\n    stateRef: StateRef<S, E>,\n): StateLink<S, E>;\nexport function useStateLinkUnmounted<S, E extends {}, R>(\n    state: StateRef<S, E>,\n    transform?: (state: StateLink<S, E>) => R\n): R {\n    const stateRef = state as StateRefImpl<S, E>;\n    const link = new StateLinkImpl<S, E>(\n        stateRef.state,\n        RootPath,\n        // it is assumed the client discards the state link once it is used\n        () => {\n            throw new Error('Internal Error: unexpected call');\n        },\n        stateRef.state.get(RootPath)\n    ).with(DisabledTracking) // it does not matter how it is used, it is not subscribed anyway\n    if (transform) {\n        return transform(link);\n    }\n    return link as unknown as R;\n}\n\n// tslint:disable-next-line: function-name\nexport function DisabledTracking(): Plugin<{}, {}> {\n    return {\n        id: DisabledTrackingID,\n        instanceFactory: () => ({\n            extensions: [],\n            extensionsFactory: () => ({})\n        })\n    }\n}\n\nexport interface PrerenderExtensions {\n    enablePrerender(equals?: (newValue: TransformResult, prevValue: TransformResult) => boolean): void;\n}\n\n// tslint:disable-next-line: function-name\nexport function Prerender<S, E extends {}>(marker: PluginTypeMarker<S, E>):\n    Plugin<E, PrerenderExtensions> {\n\n    function defaultEquals(a: TransformResult, b: TransformResult) {\n        return a === b;\n    }\n\n    return {\n        id: PrerenderID,\n        instanceFactory: () => ({\n            extensions: ['enablePrerender'],\n            extensionsFactory: (l: StateLink<StateValueAtPath, E>) => ({\n                enablePrerender: (equals) => {\n                    l[PrerenderID] = equals || defaultEquals\n                },\n            })\n        })\n    }\n}\n\nexport default useStateLink;\n"],"names":["tslib_1.__extends"],"mappings":"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"}