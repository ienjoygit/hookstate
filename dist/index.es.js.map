{"version":3,"file":"index.es.js","sources":["../node_modules/tslib/tslib.es6.js","../src/UseStateLink.tsx"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import React from 'react';\nimport { instanceOf } from 'prop-types';\n\n//\n// DECLARATIONS\n//\n\nexport interface StateRef<S> {\n    // placed to make sure type inference does not match compatible structure\n    // on useStateLink call\n    __synteticTypeInferenceMarkerRef: symbol;\n    with(plugin: () => Plugin): StateRef<S>;\n    wrap<R>(transform: (state: StateLink<S>, prev: R | undefined) => R): StateInf<R>\n    destroy(): void\n}\n\n// R captures the type of result of transform function\nexport interface StateInf<R> {\n    // placed to make sure type inference does not match empty structure\n    // on useStateLink call\n    __synteticTypeInferenceMarkerInf: symbol;\n    with(plugin: () => Plugin): StateInf<R>;\n    wrap<R2>(transform: (state: R, prev: R2 | undefined) => R2): StateInf<R2>\n    destroy(): void;\n}\n\n// TODO add support for Map and Set\nexport type NestedInferredLink<S> =\n    S extends ReadonlyArray<(infer U)> ? ReadonlyArray<StateLink<U>> :\n    S extends null ? undefined :\n    S extends object ? { readonly [K in keyof Required<S>]: StateLink<S[K]>; } :\n    undefined;\n\nexport type Path = ReadonlyArray<string | number>;\n\nexport type SetStateAction<S> = (S | Promise<S>) | ((prevState: S) => (S | Promise<S>));\n\nexport type SetPartialStateAction<S> =\n    S extends ReadonlyArray<(infer U)> ?\n        ReadonlyArray<U> | Record<number, U> | ((prevValue: S) => (ReadonlyArray<U> | Record<number, U>)) :\n    S extends object | string ? Partial<S> | ((prevValue: S) => Partial<S>) :\n    React.SetStateAction<S>;\n\nexport interface StateLink<S> {\n    readonly path: Path;\n    readonly nested: NestedInferredLink<S>;\n\n    // keep value in addition to get() because typescript compiler\n    // does not handle elimination of undefined with get(), like in this example:\n    // const state = useStateLink<number | undefined>(0)\n    // const myvalue: number = statelink.value ? statelink.value + 1 : 0; // <-- compiles\n    // const myvalue: number = statelink.get() ? statelink.get() + 1 : 0; // <-- does not compile\n    readonly value: S;\n\n    /** @warning experimental feature */\n    readonly promised: boolean;\n    /** @warning experimental feature */\n    readonly error: ErrorValueAtPath | undefined;\n\n    get(): S;\n    set(newValue: SetStateAction<S>): void;\n    merge(newValue: SetPartialStateAction<S>): void;\n\n    with(plugin: () => Plugin): StateLink<S>;\n    with(pluginId: symbol): [StateLink<S> & StateLinkPlugable<S>, PluginInstance];\n}\n\nexport interface StateLinkPlugable<S> {\n    getUntracked(): S;\n    setUntracked(newValue: SetStateAction<S>): Path;\n    mergeUntracked(mergeValue: SetPartialStateAction<S>): Path | Path[];\n    update(path: Path | Path[]): void;\n}\n\n// type alias to highlight the places where we are dealing with root state value\n// tslint:disable-next-line: no-any\nexport type StateValueAtRoot = any;\n// tslint:disable-next-line: no-any\nexport type StateValueAtPath = any;\n// tslint:disable-next-line: no-any\nexport type ErrorValueAtPath = any;\n\nexport type InitialValueAtRoot<S> = S | Promise<S> | (() => S | Promise<S>)\n\n/** @warning experimental feature */\nexport const None = Symbol('none') as StateValueAtPath;\n\nexport interface PluginInstance {\n    // if returns defined value,\n    // it overrides the current / initial value in the state\n    // it is only applicable for plugins attached via stateref, not via statelink\n    readonly onInit?: () => StateValueAtRoot | void,\n    readonly onPreset?: (path: Path, prevState: StateValueAtRoot,\n        newValue: StateValueAtPath, prevValue: StateValueAtPath,\n        mergeValue: StateValueAtPath | undefined) => void | StateValueAtRoot,\n    readonly onSet?: (path: Path, newState: StateValueAtRoot,\n        newValue: StateValueAtPath, prevValue: StateValueAtPath,\n        mergeValue: StateValueAtPath | undefined) => void,\n    readonly onDestroy?: (state: StateValueAtRoot) => void,\n};\n\nexport interface Plugin {\n    readonly id: symbol;\n    readonly instanceFactory: (\n        initial: StateValueAtRoot, linkFactory: () => StateLink<StateValueAtRoot>\n    ) => PluginInstance;\n}\n\n//\n// INTERNAL IMPLEMENTATIONS\n//\n\nclass StateLinkInvalidUsageError extends Error {\n    constructor(op: string, path: Path, hint?: string) {\n        super(`StateLink is used incorrectly. Attempted '${op}' at '/${path.join('/')}'` +\n            (hint ? `. Hint: ${hint}` : ''))\n    }\n}\n\nfunction extractSymbol(s: symbol) {\n    let result = s.toString();\n    const symstr = 'Symbol('\n    if (result.startsWith(symstr) && result.endsWith(')')) {\n        result = result.substring(symstr.length, result.length - 1)\n    }\n    return result;\n}\n\nclass PluginInvalidRegistrationError extends Error {\n    constructor(id: symbol, path: Path) {\n        super(`Plugin with onInit, which overrides initial value, ` +\n        `should be attached to StateRef instance, but not to StateLink instance. ` +\n        `Attempted 'with(${extractSymbol(id)})' at '/${path.join('/')}'`)\n    }\n}\n\nclass PluginUnknownError extends Error {\n    constructor(s: symbol) {\n        super(`Plugin '${extractSymbol(s)}' has not been attached to the StateRef or StateLink. ` +\n            `Hint: you might need to register the required plugin using 'with' method. ` +\n            `See https://github.com/avkonst/hookstate#plugins for more details`)\n    }\n}\n\ninterface Subscriber {\n    onSet(path: Path, actions: (() => void)[]): void;\n}\n\ntype PresetCallback = (path: Path, prevState: StateValueAtRoot,\n    newValue: StateValueAtPath, prevValue: StateValueAtPath,\n    mergeValue: StateValueAtPath | undefined) => void | StateValueAtRoot;\ntype SetCallback = (path: Path, newState: StateValueAtRoot,\n    newValue: StateValueAtPath, prevValue: StateValueAtPath,\n    mergeValue: StateValueAtPath | undefined) => void;\ntype DestroyCallback = (state: StateValueAtRoot) => void;\n\ninterface Subscribable {\n    subscribe(l: Subscriber): void;\n    unsubscribe(l: Subscriber): void;\n}\n\nconst DowngradedID = Symbol('Downgraded');\nconst StateMemoID = Symbol('StateMemo');\nconst ProxyMarkerID = Symbol('ProxyMarker');\n\nconst RootPath: Path = [];\nconst DestroyedEdition = -1\n\nclass State implements Subscribable {\n    private _edition: number = 0;\n\n    private _subscribers: Set<Subscriber> = new Set();\n    private _presetSubscribers: Set<PresetCallback> = new Set();\n    private _setSubscribers: Set<SetCallback> = new Set();\n    private _destroySubscribers: Set<DestroyCallback> = new Set();\n\n    private _plugins: Map<symbol, PluginInstance> = new Map();\n\n    private _promised: Promised | undefined;\n\n    constructor(private _value: StateValueAtRoot) {\n        if (typeof _value === 'object' &&\n            Promise.resolve(_value) as StateValueAtRoot === _value) {\n            this._promised = Promised.create(_value, this)\n            this._value = None\n        }\n    }\n\n    get edition() {\n        return this._edition;\n    }\n\n    get promised() {\n        return this._promised;\n    }\n\n    get(path: Path) {\n        let result = this._value;\n        if (result === None) {\n            return result;\n        }\n        path.forEach(p => {\n            result = result[p];\n        });\n        return result;\n    }\n\n    set(path: Path, value: StateValueAtPath, mergeValue: Partial<StateValueAtPath> | undefined): Path {\n        if (this._edition < 0) {\n            // TODO convert to warning\n            throw new StateLinkInvalidUsageError(\n                `set state for the destroyed state`,\n                path,\n                'make sure all asynchronous operations are cancelled (unsubscribed) when the state is destroyed. ' +\n                'Global state is explicitly destroyed at \\'StateRef.destroy()\\'. ' +\n                'Local state is automatically destroyed when a component is unmounted.')\n        }\n\n        if (path.length === 0) {\n            // Root value UPDATE case,\n\n            if (value === None) {\n                // never ending promise, unless it is displaced by antoher set later on\n                this._promised = Promised.create(new Promise(() => { /* */ }), this)\n            } else if (typeof value === 'object' && Promise.resolve(value) === value) {\n                this._promised = Promised.create(value, this)\n                value = None\n            } else {\n                this._promised = undefined\n            }\n\n            let prevValue = this._value;\n            this.beforeSet(path, value, prevValue, mergeValue)\n            this._value = value;\n            this.afterSet(path, value, prevValue, mergeValue)\n\n            return path;\n        }\n\n        if (typeof value === 'object' && Promise.resolve(value) === value) {\n            throw new StateLinkInvalidUsageError(\n                // TODO add hint\n                'set promise for nested property', path, ''\n            )\n        }\n\n        let target = this._value;\n        for (let i = 0; i < path.length - 1; i += 1) {\n            target = target[path[i]];\n        }\n\n        const p = path[path.length - 1]\n        if (p in target) {\n            if (value !== None) {\n                // Property UPDATE case\n                let prevValue = target[p]\n                this.beforeSet(path, value, prevValue, mergeValue)\n                target[p] = value;\n                this.afterSet(path, value, prevValue, mergeValue)\n\n                return path;\n            } else {\n                // Property DELETE case\n                let prevValue = target[p]\n                this.beforeSet(path, value, prevValue, mergeValue)\n                if (Array.isArray(target) && typeof p === 'number') {\n                    target.splice(p, 1)\n                } else {\n                    delete target[p]\n                }\n                this.afterSet(path, value, prevValue, mergeValue)\n\n                // if an array of object is about to loose existing property\n                // we consider it is the whole object is changed\n                // which is identified by upper path\n                return path.slice(0, -1)\n            }\n        }\n\n        if (value !== None) {\n            // Property INSERT case\n            this.beforeSet(path, value, None, mergeValue)\n            target[p] = value;\n            this.afterSet(path, value, None, mergeValue)\n\n            // if an array of object is about to be extended by new property\n            // we consider it is the whole object is changed\n            // which is identified by upper path\n            return path.slice(0, -1)\n        }\n\n        // Non-existing property DELETE case\n        // no-op\n        return path;\n    }\n\n    update(path: Path) {\n        const actions: (() => void)[] = [];\n        this._subscribers.forEach(s => s.onSet(path, actions));\n        actions.forEach(a => a());\n    }\n\n    updateBatch(paths: Path[]) {\n        const actions: (() => void)[] = [];\n        paths.forEach(path => {\n            this._subscribers.forEach(s => s.onSet(path, actions));\n        })\n        actions.forEach(a => a());\n    }\n\n    beforeSet(path: Path, value: StateValueAtPath, prevValue: StateValueAtPath,\n        mergeValue: StateValueAtPath | undefined) {\n        if (this._edition !== DestroyedEdition) {\n            this._presetSubscribers.forEach(cb => {\n                const presetResult = cb(path, this._value, value, prevValue, mergeValue)\n                if (presetResult !== undefined) {\n                    // plugin overrides the current value\n                    // could be used for immutable later on\n                    this._value = presetResult\n                }\n            })\n        }\n    }\n\n    afterSet(path: Path, value: StateValueAtPath, prevValue: StateValueAtPath,\n        mergeValue: StateValueAtPath | undefined) {\n        if (this._edition !== DestroyedEdition) {\n            this._edition += 1;\n            this._setSubscribers.forEach(cb => cb(path, this._value, value, prevValue, mergeValue))\n        }\n    }\n\n    getPlugin(pluginId: symbol) {\n        const existingInstance = this._plugins.get(pluginId)\n        if (existingInstance) {\n            return existingInstance;\n        }\n        throw new PluginUnknownError(pluginId)\n    }\n\n    register(plugin: Plugin, path?: Path | undefined) {\n        const existingInstance = this._plugins.get(plugin.id)\n        if (existingInstance) {\n            return;\n        }\n        const pluginInstance = plugin.instanceFactory(\n            this._value,\n            () => useStateLinkUnmounted(new StateRefImpl(this))\n        );\n        this._plugins.set(plugin.id, pluginInstance);\n        if (pluginInstance.onInit) {\n            const initValue = pluginInstance.onInit()\n            if (initValue !== undefined) {\n                if (path) {\n                    throw new PluginInvalidRegistrationError(plugin.id, path);\n                }\n                this._value = initValue;\n            }\n        }\n        if (pluginInstance.onPreset) {\n            this._presetSubscribers.add((p, s, v, pv, mv) => pluginInstance.onPreset!(p, s, v, pv, mv))\n        }\n        if (pluginInstance.onSet) {\n            this._setSubscribers.add((p, s, v, pv, mv) => pluginInstance.onSet!(p, s, v, pv, mv))\n        }\n        if (pluginInstance.onDestroy) {\n            this._destroySubscribers.add((s) => pluginInstance.onDestroy!(s))\n        }\n        return;\n    }\n\n    subscribe(l: Subscriber) {\n        this._subscribers.add(l);\n    }\n\n    unsubscribe(l: Subscriber) {\n        this._subscribers.delete(l);\n    }\n\n    destroy() {\n        this._destroySubscribers.forEach(cb => cb(this._value))\n        this._edition = DestroyedEdition\n    }\n\n    toJSON() {\n        throw new StateLinkInvalidUsageError('toJSON()', RootPath,\n        'did you mean to use JSON.stringify(state.get()) instead of JSON.stringify(state)?');\n    }\n}\n\nconst SynteticID = Symbol('SynteticTypeInferenceMarker');\nconst ValueCache = Symbol('ValueCache');\nconst NestedCache = Symbol('NestedCache');\nconst UnmountedCallback = Symbol('UnmountedCallback');\n\nclass StateRefImpl<S> implements StateRef<S> {\n    // tslint:disable-next-line: variable-name\n    public __synteticTypeInferenceMarkerRef = SynteticID;\n    public disabledTracking: boolean | undefined;\n\n    constructor(public state: State) { }\n\n    with(plugin: () => Plugin): StateRef<S> {\n        const pluginMeta = plugin()\n        if (pluginMeta.id === DowngradedID) {\n            this.disabledTracking = true;\n            return this;\n        }\n        this.state.register(pluginMeta);\n        return this;\n    }\n\n    wrap<R>(transform: (state: StateLink<S>, prev: R | undefined) => R): StateInf<R> {\n        return new StateInfImpl(this, transform)\n    }\n\n    destroy() {\n        this.state.destroy()\n    }\n}\n\nclass StateInfImpl<S, R> implements StateInf<R> {\n    // tslint:disable-next-line: variable-name\n    public __synteticTypeInferenceMarkerInf = SynteticID;\n\n    constructor(\n        public readonly wrapped: StateRefImpl<S>,\n        public readonly transform: (state: StateLink<S>, prev: R | undefined) => R,\n    ) { }\n\n    with(plugin: () => Plugin): StateInf<R> {\n        this.wrapped.with(plugin);\n        return this;\n    }\n\n    wrap<R2>(transform: (state: R, prev: R2 | undefined) => R2): StateInf<R2> {\n        return new StateInfImpl(this.wrapped, (s, p) => {\n            return transform(this.transform(s, undefined), p)\n        })\n    }\n\n    destroy() {\n        this.wrapped.destroy()\n    }\n}\n\nclass Promised {\n    public fullfilled?: true;\n    public error?: ErrorValueAtPath;\n    public value?: StateValueAtPath;\n\n    constructor(public promise: Promise<StateValueAtPath> | undefined,\n        onResolve: (r: StateValueAtPath) => void,\n        onReject: () => void) {\n        if (promise) {\n            promise\n            .then(r => {\n                this.fullfilled = true\n                this.value = r\n                onResolve(r)\n            })\n            .catch(err => {\n                this.fullfilled = true\n                this.error = err\n                onReject()\n            })\n        }\n    }\n\n    static create(newValue: StateValueAtPath, state: State) {\n        const promised = new Promised(\n            Promise.resolve(newValue),\n            (r: StateValueAtPath) => {\n                if (state.promised === promised) {\n                    state.set(RootPath, r, undefined)\n                    state.update(RootPath)\n                }\n            },\n            () => {\n                if (state.promised === promised) {\n                    state.update(RootPath)\n                }\n            }\n        );\n        return promised;\n    }\n}\n\nclass StateLinkImpl<S> implements StateLink<S>,\n    StateLinkPlugable<S>, Subscribable, Subscriber {\n    public disabledTracking: boolean | undefined;\n    private subscribers: Set<Subscriber> | undefined;\n\n    private nestedLinksCache: Record<string | number, StateLinkImpl<S[keyof S]>> | undefined;\n\n    constructor(\n        public readonly state: State,\n        public readonly path: Path,\n        public onUpdateUsed: (() => void),\n        public valueSource: S,\n        public valueEdition: number\n    ) { }\n\n    getUntracked(allowPromised?: boolean) {\n        if (this.valueEdition !== this.state.edition) {\n            this.valueSource = this.state.get(this.path)\n            this.valueEdition = this.state.edition\n\n            if (this.onUpdateUsed[UnmountedCallback]) {\n                // this link is not mounted to a component\n                // for example, it might be global link or\n                // a link which has been discarded after rerender\n                // but still captured by some callback or an effect\n                delete this[ValueCache]\n                delete this[NestedCache]\n            } else {\n                // this link is still mounted to a component\n                // populate cache again to ensure correct tracking of usage\n                // when React scans which states to rerender on update\n                if (ValueCache in this) {\n                    delete this[ValueCache]\n                    this.get(true)\n                }\n                if (NestedCache in this) {\n                    delete this[NestedCache]\n                    // tslint:disable-next-line no-unused-expression\n                    this.nested // trigger call to mark 'nested' as used again\n                }\n            }\n        }\n        if (this.valueSource === None && !allowPromised) {\n            if (this.state.promised!.error) {\n                throw this.state.promised!.error;\n            }\n            // TODO add hint\n            throw new StateLinkInvalidUsageError('read promised state', this.path)\n        }\n        return this.valueSource;\n    }\n\n    get(allowPromised?: boolean) {\n        const currentValue = this.getUntracked(allowPromised)\n        if (this[ValueCache] === undefined) {\n            if (this.disabledTracking) {\n                this[ValueCache] = currentValue;\n            } else if (Array.isArray(currentValue)) {\n                this[ValueCache] = this.valueArrayImpl(currentValue);\n            } else if (typeof currentValue === 'object' && currentValue !== null) {\n                this[ValueCache] = this.valueObjectImpl(currentValue as unknown as object);\n            } else {\n                this[ValueCache] = currentValue;\n            }\n        }\n        return this[ValueCache] as S;\n    }\n\n    get value(): S {\n        return this.get()\n    }\n\n    get promised() {\n        const currentValue = this.get(true) // marks used\n        if (currentValue === None && !this.state.promised!.fullfilled) {\n            return true;\n        }\n        return false;\n    }\n\n    get error() {\n        const currentValue = this.get(true) // marks used\n        if (currentValue === None) {\n            if (this.state.promised!.fullfilled) {\n                return this.state.promised!.error;\n            }\n            this.get() // will throw 'read while promised' exception\n        }\n        return undefined;\n    }\n\n    setUntracked(newValue: SetStateAction<S>, mergeValue?: Partial<StateValueAtPath>): Path {\n        if (typeof newValue === 'function') {\n            newValue = (newValue as ((prevValue: S) => S))(this.getUntracked());\n        }\n        if (typeof newValue === 'object' && newValue !== null && newValue[ProxyMarkerID]) {\n            throw new StateLinkInvalidUsageError(\n                `set(state.get() at '/${newValue[ProxyMarkerID].path.join('/')}')`,\n                this.path,\n                'did you mean to use state.set(lodash.cloneDeep(value)) instead of state.set(value)?')\n        }\n        return this.state.set(this.path, newValue, mergeValue);\n    }\n\n    set(newValue: React.SetStateAction<S>) {\n        this.state.update(this.setUntracked(newValue));\n    }\n\n    mergeUntracked(sourceValue: SetPartialStateAction<S>) {\n        const currentValue = this.getUntracked()\n        if (typeof sourceValue === 'function') {\n            sourceValue = (sourceValue as Function)(currentValue);\n        }\n\n        const maximumPropsForCherryPickUpdate = 5;\n\n        let updatedPath: Path;\n        let deletedOrInsertedProps = false\n        let totalUpdatedProps = 0\n\n        if (Array.isArray(currentValue)) {\n            if (Array.isArray(sourceValue)) {\n                updatedPath = this.setUntracked(currentValue.concat(sourceValue) as unknown as S, sourceValue)\n            } else {\n                const deletedIndexes: number[] = []\n                Object.keys(sourceValue).sort().forEach(i => {\n                    const index = Number(i);\n                    const newPropValue = sourceValue[index]\n                    if (newPropValue === None) {\n                        deletedOrInsertedProps = true\n                        deletedIndexes.push(index)\n                    } else {\n                        deletedOrInsertedProps = deletedOrInsertedProps || !(index in currentValue)\n                        currentValue[index] = newPropValue\n                    }\n                    totalUpdatedProps += 1\n                });\n                // indexes are ascending sorted as per above\n                // so, delete one by one from the end\n                // this way index positions do not change\n                deletedIndexes.reverse().forEach(p => {\n                    (currentValue as unknown as []).splice(p, 1)\n                })\n                updatedPath = this.setUntracked(currentValue, sourceValue)\n            }\n        } else if (typeof currentValue === 'object' && currentValue !== null) {\n            Object.keys(sourceValue).forEach(key => {\n                const newPropValue = sourceValue[key]\n                if (newPropValue === None) {\n                    deletedOrInsertedProps = true\n                    delete currentValue[key]\n                } else {\n                    deletedOrInsertedProps = deletedOrInsertedProps || !(key in currentValue)\n                    currentValue[key] = newPropValue\n                }\n                totalUpdatedProps += 0\n            })\n            updatedPath = this.setUntracked(currentValue, sourceValue)\n        } else if (typeof currentValue === 'string') {\n            return this.setUntracked((currentValue + String(sourceValue)) as unknown as S)\n        } else {\n            return this.setUntracked(sourceValue as S)\n        }\n\n        if (updatedPath !== this.path || deletedOrInsertedProps ||\n            totalUpdatedProps > maximumPropsForCherryPickUpdate) {\n            return updatedPath\n        }\n        return Object.keys(sourceValue).map(p => updatedPath.slice().concat(p))\n    }\n\n    merge(sourceValue: SetPartialStateAction<S>) {\n        this.update(this.mergeUntracked(sourceValue));\n    }\n\n    update(path: Path | Path[]) {\n        if (path.length === 0 || typeof path[0] === 'string' || typeof path[0] === 'number') {\n            this.state.update(path as Path)\n        } else {\n            this.state.updateBatch(path as Path[])\n        }\n    }\n\n    with(plugin: () => Plugin): StateLink<S>;\n    with(pluginId: symbol): [StateLink<S> & StateLinkPlugable<S>, PluginInstance];\n    with(plugin: (() => Plugin) | symbol):\n        StateLink<S> | [StateLink<S> & StateLinkPlugable<S>, PluginInstance] {\n        if (typeof plugin === 'function') {\n            const pluginMeta = plugin();\n            if (pluginMeta.id === DowngradedID) {\n                this.disabledTracking = true;\n                return this;\n            }\n            this.state.register(pluginMeta, this.path);\n            return this;\n        } else {\n            return [this, this.state.getPlugin(plugin)];\n        }\n    }\n\n    subscribe(l: Subscriber) {\n        if (this.subscribers === undefined) {\n            this.subscribers = new Set();\n        }\n        this.subscribers.add(l);\n    }\n\n    unsubscribe(l: Subscriber) {\n        this.subscribers!.delete(l);\n    }\n\n    onSet(path: Path, actions: (() => void)[]) {\n        this.updateIfUsed(path, actions)\n    }\n\n    private updateIfUsed(path: Path, actions: (() => void)[]): boolean {\n        const update = () => {\n            if (this.disabledTracking &&\n                (ValueCache in this || NestedCache in this)) {\n                actions.push(this.onUpdateUsed);\n                return true;\n            }\n            const firstChildKey = path[this.path.length];\n            if (firstChildKey === undefined) {\n                if (ValueCache in this || NestedCache in this) {\n                    actions.push(this.onUpdateUsed);\n                    return true;\n                }\n                return false;\n            }\n            const firstChildValue = this.nestedLinksCache && this.nestedLinksCache[firstChildKey];\n            if (firstChildValue === undefined) {\n                return false;\n            }\n            return firstChildValue.updateIfUsed(path, actions);\n        }\n\n        const updated = update();\n        if (!updated && this.subscribers !== undefined) {\n            this.subscribers.forEach(s => {\n                s.onSet(path, actions)\n            })\n        }\n        return updated;\n    }\n\n    get nested(): NestedInferredLink<S> {\n        const currentValue = this.getUntracked()\n        if (this[NestedCache] === undefined) {\n            if (Array.isArray(currentValue)) {\n                this[NestedCache] = this.nestedArrayImpl(currentValue);\n            } else if (typeof currentValue === 'object' && currentValue !== null) {\n                this[NestedCache] = this.nestedObjectImpl(currentValue as unknown as object);\n            } else {\n                this[NestedCache] = undefined;\n            }\n        }\n        return this[NestedCache] as NestedInferredLink<S>;\n    }\n\n    private nestedArrayImpl(currentValue: StateValueAtPath[]): NestedInferredLink<S> {\n        this.nestedLinksCache = this.nestedLinksCache || {};\n        const proxyGetterCache = this.nestedLinksCache;\n\n        const getter = (target: object, key: PropertyKey) => {\n            if (key === 'length') {\n                return (target as []).length;\n            }\n            if (key in Array.prototype) {\n                return Array.prototype[key];\n            }\n            if (key === ProxyMarkerID) {\n                return this;\n            }\n            if (typeof key === 'symbol') {\n                return undefined;\n            }\n            const index = Number(key);\n            if (!Number.isInteger(index)) {\n                return undefined;\n            }\n            const cachehit = proxyGetterCache[index];\n            if (cachehit) {\n                return cachehit;\n            }\n            const r = new StateLinkImpl(\n                this.state,\n                this.path.slice().concat(index),\n                this.onUpdateUsed,\n                target[index],\n                this.valueEdition\n            )\n            if (this.disabledTracking) {\n                r.disabledTracking = true;\n            }\n            proxyGetterCache[index] = r;\n            return r;\n        };\n        return this.proxyWrap(currentValue, getter) as\n            unknown as NestedInferredLink<S>;\n    }\n\n    private valueArrayImpl(currentValue: StateValueAtPath[]): S {\n        return this.proxyWrap(currentValue,\n            (target: object, key: PropertyKey) => {\n                if (key === 'length') {\n                    return (target as []).length;\n                }\n                if (key in Array.prototype) {\n                    return Array.prototype[key];\n                }\n                if (key === ProxyMarkerID) {\n                    return this;\n                }\n                if (typeof key === 'symbol') {\n                    // allow clients to associate hidden cache with state values\n                    return target[key];\n                }\n                const index = Number(key);\n                if (!Number.isInteger(index)) {\n                    return undefined;\n                }\n                return (this.nested)![index].value;\n            },\n            (target: object, key: PropertyKey, value: StateValueAtPath) => {\n                if (typeof key === 'symbol') {\n                    // allow clients to associate hidden cache with state values\n                    target[key] = value;\n                    return true;\n                }\n                throw new StateLinkInvalidUsageError('set', this.path,\n                    `did you mean to use 'state.nested[${key}].set(value)' instead of 'state[${key}] = value'?`)\n            }\n        ) as unknown as S;\n    }\n\n    private nestedObjectImpl(currentValue: object): NestedInferredLink<S> {\n        this.nestedLinksCache = this.nestedLinksCache || {};\n        const proxyGetterCache = this.nestedLinksCache;\n\n        const getter = (target: object, key: PropertyKey) => {\n            if (key === ProxyMarkerID) {\n                return this;\n            }\n            if (typeof key === 'symbol') {\n                return undefined;\n            }\n            const cachehit = proxyGetterCache[key];\n            if (cachehit) {\n                return cachehit;\n            }\n            const r = new StateLinkImpl(\n                this.state,\n                this.path.slice().concat(key.toString()),\n                this.onUpdateUsed,\n                target[key],\n                this.valueEdition\n            );\n            if (this.disabledTracking) {\n                r.disabledTracking = true;\n            }\n            proxyGetterCache[key] = r;\n            return r;\n        };\n        return this.proxyWrap(currentValue, getter) as\n            unknown as NestedInferredLink<S>;\n    }\n\n    private valueObjectImpl(currentValue: object): S {\n        return this.proxyWrap(currentValue,\n            (target: object, key: PropertyKey) => {\n                if (key === ProxyMarkerID) {\n                    return this;\n                }\n                if (typeof key === 'symbol') {\n                    // allow clients to associate hidden cache with state values\n                    return target[key];\n                }\n                return (this.nested)![key].value;\n            },\n            (target: object, key: PropertyKey, value: StateValueAtPath) => {\n                if (typeof key === 'symbol') {\n                    // allow clients to associate hidden cache with state values\n                    target[key] = value;\n                    return true;\n                }\n                throw new StateLinkInvalidUsageError('set', this.path,\n                    `did you mean to use 'state.nested.${key}.set(value)' instead of 'state.${key} = value'?`)\n            }\n        ) as unknown as S;\n    }\n\n    // tslint:disable-next-line: no-any\n    private proxyWrap(objectToWrap: any,\n        // tslint:disable-next-line: no-any\n        getter: (target: any, key: PropertyKey) => any,\n        // tslint:disable-next-line: no-any\n        setter?: (target: any, p: PropertyKey, value: any, receiver: any) => boolean\n    ) {\n        const onInvalidUsage = (op: string) => {\n            throw new StateLinkInvalidUsageError(op, this.path)\n        }\n        return new Proxy(objectToWrap, {\n            getPrototypeOf: (target) => {\n                return Object.getPrototypeOf(target);\n            },\n            setPrototypeOf: (target, v) => {\n                return onInvalidUsage('setPrototypeOf')\n            },\n            isExtensible: (target) => {\n                // should satisfy the invariants:\n                // https://developer.mozilla.org/en-US/docs/Web/JavaScript/\n                // Reference/Global_Objects/Proxy/handler/isExtensible#Invariants\n                return Object.isExtensible(target);\n            },\n            preventExtensions: (target) => {\n                return onInvalidUsage('preventExtensions')\n            },\n            getOwnPropertyDescriptor: (target, p) => {\n                const origin = Object.getOwnPropertyDescriptor(target, p);\n                if (origin && Array.isArray(target) && p in Array.prototype) {\n                    return origin;\n                }\n                return origin && {\n                    configurable: true, // JSON.stringify() does not work for an object without it\n                    enumerable: origin.enumerable,\n                    get: () => getter(target as object, p),\n                    set: undefined\n                };\n            },\n            has: (target, p) => {\n                if (typeof p === 'symbol') {\n                    return false;\n                }\n                return p in target;\n            },\n            get: getter,\n            set: setter || ((target, p, value, receiver) => {\n                return onInvalidUsage('set')\n            }),\n            deleteProperty: (target, p) => {\n                return onInvalidUsage('deleteProperty')\n            },\n            defineProperty: (target, p, attributes) => {\n                return onInvalidUsage('defineProperty')\n            },\n            enumerate: (target) => {\n                if (Array.isArray(target)) {\n                    return Object.keys(target).concat('length');\n                }\n                return Object.keys(target);\n            },\n            ownKeys: (target) => {\n                if (Array.isArray(target)) {\n                    return Object.keys(target).concat('length');\n                }\n                return Object.keys(target);\n            },\n            apply: (target, thisArg, argArray?) => {\n                return onInvalidUsage('apply')\n            },\n            construct: (target, argArray, newTarget?) => {\n                return onInvalidUsage('construct')\n            }\n        });\n    }\n}\n\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\nconst NoAction = () => { /* empty */ };\nconst NoActionUnmounted = () => { /* empty */ };\nNoActionUnmounted[UnmountedCallback] = true\n\nfunction createState<S>(initial: InitialValueAtRoot<S>): State {\n    let initialValue: S | Promise<S> = initial as (S | Promise<S>);\n    if (typeof initial === 'function') {\n        initialValue = (initial as (() => S | Promise<S>))();\n    }\n    if (typeof initialValue === 'object' && initialValue[ProxyMarkerID]) {\n        throw new StateLinkInvalidUsageError(\n            `create/useStateLink(state.get() at '/${initialValue[ProxyMarkerID].path.join('/')}')`,\n            RootPath,\n            'did you mean to use create/useStateLink(state) OR ' +\n            'create/useStateLink(lodash.cloneDeep(state.get())) instead of create/useStateLink(state.get())?')\n    }\n    return new State(initialValue);\n}\n\nfunction useSubscribedStateLink<S>(\n    state: State,\n    path: Path,\n    update: () => void,\n    subscribeTarget: Subscribable,\n    disabledTracking: boolean | undefined,\n    onDestroy: () => void\n) {\n    const link = new StateLinkImpl<S>(\n        state,\n        path,\n        update,\n        state.get(path),\n        state.edition\n    );\n    if (disabledTracking) {\n        link.with(Downgraded)\n    }\n    useIsomorphicLayoutEffect(() => {\n        subscribeTarget.subscribe(link);\n        return () => {\n            link.onUpdateUsed[UnmountedCallback] = true\n            subscribeTarget.unsubscribe(link);\n        }\n    });\n    React.useEffect(() => () => onDestroy(), []);\n    return link;\n}\n\nfunction useGlobalStateLink<S>(stateRef: StateRefImpl<S>): StateLinkImpl<S> {\n    const [value, setValue] = React.useState({ state: stateRef.state });\n    return useSubscribedStateLink(\n        value.state,\n        RootPath,\n        () => setValue({ state: value.state }),\n        value.state,\n        stateRef.disabledTracking,\n        NoAction);\n}\n\nfunction useLocalStateLink<S>(initialState: InitialValueAtRoot<S>): StateLinkImpl<S> {\n    const [value, setValue] = React.useState(() => ({ state: createState(initialState) }));\n    return useSubscribedStateLink(\n        value.state,\n        RootPath,\n        () => setValue({ state: value.state }),\n        value.state,\n        undefined,\n        () => value.state.destroy());\n}\n\nfunction useScopedStateLink<S>(originLink: StateLinkImpl<S>): StateLinkImpl<S> {\n    const [, setValue] = React.useState({});\n    return useSubscribedStateLink(\n        originLink.state,\n        originLink.path,\n        () => setValue({}),\n        originLink,\n        originLink.disabledTracking,\n        NoAction);\n}\n\nfunction useAutoStateLink<S>(\n    initialState: InitialValueAtRoot<S> | StateLink<S> | StateRef<S>\n): StateLinkImpl<S> {\n    if (initialState instanceof StateLinkImpl) {\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        return useScopedStateLink(initialState as StateLinkImpl<S>);\n    }\n    if (initialState instanceof StateRefImpl) {\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        return useGlobalStateLink(initialState as StateRefImpl<S>);\n    }\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    return useLocalStateLink(initialState as InitialValueAtRoot<S>);\n}\n\nfunction injectTransform<S, R>(\n    link: StateLinkImpl<S>,\n    transform: (state: StateLink<S>, prev: R | undefined) => R\n) {\n    if (link.onUpdateUsed[UnmountedCallback]) {\n        // this is unmounted link\n        return transform(link, undefined);\n    }\n    let injectedOnUpdateUsed: (() => void) | undefined = undefined;\n    const originOnUpdateUsed = link.onUpdateUsed;\n    link.onUpdateUsed = () => {\n        if (injectedOnUpdateUsed) {\n            return injectedOnUpdateUsed();\n        }\n        return originOnUpdateUsed();\n    }\n\n    const result = transform(link, undefined);\n    const stateMemoEquals: ((a: R, b: R) => boolean) | undefined = link[StateMemoID];\n    if (stateMemoEquals === undefined) {\n        return result;\n    }\n    delete link[StateMemoID];\n\n    injectedOnUpdateUsed = () => {\n        const updatedResult = transform(link, result);\n        // if result is not changed, it does not affect the rendering result too\n        // so, we skip triggering rerendering in this case\n        if (!stateMemoEquals(updatedResult, result)) {\n            originOnUpdateUsed();\n        }\n    }\n    return result;\n}\n\n///\n/// EXPORTED IMPLEMENTATIONS\n///\nexport function createStateLink<S>(\n    initial: InitialValueAtRoot<S>\n): StateRef<S>;\nexport function createStateLink<S, R>(\n    initial: InitialValueAtRoot<S>,\n    transform: (state: StateLink<S>, prev: R | undefined) => R\n): StateInf<R>;\nexport function createStateLink<S, R>(\n    initial: InitialValueAtRoot<S>,\n    transform?: (state: StateLink<S>, prev: R | undefined) => R\n): StateRef<S> | StateInf<R> {\n    const ref = new StateRefImpl<S>(createState(initial));\n    if (transform) {\n        return new StateInfImpl(ref, transform)\n    }\n    return ref;\n}\n\nexport function useStateLink<R>(\n    source: StateInf<R>\n): R;\nexport function useStateLink<S>(\n    source: StateLink<S> | StateRef<S>\n): StateLink<S>;\nexport function useStateLink<S, R>(\n    source: StateLink<S> | StateRef<S>,\n    transform: (state: StateLink<S>, prev: R | undefined) => R\n): R;\nexport function useStateLink<S>(\n    source: InitialValueAtRoot<S>\n): StateLink<S>;\nexport function useStateLink<S, R>(\n    source: InitialValueAtRoot<S>,\n    transform: (state: StateLink<S>, prev: R | undefined) => R\n): R;\nexport function useStateLink<S, R>(\n    source: InitialValueAtRoot<S> | StateLink<S> | StateRef<S> | StateInf<R>,\n    transform?: (state: StateLink<S>, prev: R | undefined) => R\n): StateLink<S> | R {\n    const state = source instanceof StateInfImpl\n        ? source.wrapped as unknown as StateRef<S>\n        : source as (InitialValueAtRoot<S> | StateLink<S> | StateRef<S>);\n    const link = useAutoStateLink(state);\n    if (source instanceof StateInfImpl) {\n        return injectTransform(link, source.transform);\n    }\n    if (transform) {\n        return injectTransform(link, transform);\n    }\n    return link;\n}\n\n/**\n * @deprecated use accessStateLink instead\n */\nexport function useStateLinkUnmounted<R>(\n    source: StateInf<R>,\n): R;\n/**\n * @deprecated use accessStateLink instead\n */\nexport function useStateLinkUnmounted<S>(\n    source: StateRef<S>,\n): StateLink<S>;\n/**\n * @deprecated use accessStateLink instead\n */\nexport function useStateLinkUnmounted<S, R>(\n    source: StateRef<S>,\n    transform: (state: StateLink<S>) => R\n): R;\n/**\n * @deprecated use accessStateLink instead\n */\nexport function useStateLinkUnmounted<S, R>(\n    source: StateRef<S> | StateInf<R>,\n    transform?: (state: StateLink<S>) => R\n): StateLink<S> | R {\n    // tslint:disable-next-line: no-any\n    type AnyArgument = any; // typesafety is guaranteed by overloaded functions above\n    return accessStateLink(source as AnyArgument, transform as AnyArgument)\n}\n\nexport function accessStateLink<R>(\n    source: StateInf<R>,\n): R;\nexport function accessStateLink<S>(\n    source: StateRef<S>,\n): StateLink<S>;\nexport function accessStateLink<S, R>(\n    source: StateRef<S>,\n    transform: (state: StateLink<S>) => R\n): R;\nexport function accessStateLink<S, R>(\n    source: StateRef<S> | StateInf<R>,\n    transform?: (state: StateLink<S>) => R\n): StateLink<S> | R {\n    const stateRef = source instanceof StateInfImpl\n        ? source.wrapped as StateRefImpl<S>\n        : source as StateRefImpl<S>;\n    const link = new StateLinkImpl<S>(\n        stateRef.state,\n        RootPath,\n        NoActionUnmounted,\n        stateRef.state.get(RootPath),\n        stateRef.state.edition\n    ).with(Downgraded) // it does not matter how it is used, it is not subscribed anyway\n    if (source instanceof StateInfImpl) {\n        return source.transform(link, undefined);\n    }\n    if (transform) {\n        return transform(link);\n    }\n    return link;\n}\n\nexport function StateFragment<R>(\n    props: {\n        state: StateInf<R>,\n        children: (state: R) => React.ReactElement,\n    }\n): React.ReactElement;\nexport function StateFragment<S>(\n    props: {\n        state: StateLink<S> | StateRef<S>,\n        children: (state: StateLink<S>) => React.ReactElement,\n    }\n): React.ReactElement;\nexport function StateFragment<S, E extends {}, R>(\n    props: {\n        state: StateLink<S> | StateRef<S>,\n        transform: (state: StateLink<S>, prev: R | undefined) => R,\n        children: (state: R) => React.ReactElement,\n    }\n): React.ReactElement;\nexport function StateFragment<S>(\n    props: {\n        state: InitialValueAtRoot<S>,\n        children: (state: StateLink<S>) => React.ReactElement,\n    }\n): React.ReactElement;\nexport function StateFragment<S, R>(\n    props: {\n        state: InitialValueAtRoot<S>,\n        transform: (state: StateLink<S>, prev: R | undefined) => R,\n        children: (state: R) => React.ReactElement,\n    }\n): React.ReactElement;\nexport function StateFragment<S, E extends {}, R>(\n    props: {\n        state: InitialValueAtRoot<S> | StateLink<S> | StateRef<S> | StateInf<R>,\n        transform?: (state: StateLink<S>, prev: R | undefined) => R,\n        children: (state: StateLink<S> | R) => React.ReactElement,\n    }\n): React.ReactElement {\n    // tslint:disable-next-line: no-any\n    type AnyArgument = any; // typesafety is guaranteed by overloaded functions above\n    const scoped = useStateLink<S, {}>(props.state as AnyArgument, props.transform as AnyArgument);\n    return props.children(scoped as AnyArgument);\n}\n\nexport function StateMemo<S, R>(\n    transform: (state: StateLink<S>, prev: R | undefined) => R,\n    equals?: (next: R, prev: R) => boolean) {\n    return (link: StateLink<S>, prev: R | undefined) => {\n        link[StateMemoID] = equals || ((n: R, p: R) => (n === p))\n        return transform(link, prev);\n    }\n}\n\n// tslint:disable-next-line: function-name\nexport function Downgraded(): Plugin {\n    return {\n        id: DowngradedID,\n        instanceFactory: () => ({})\n    }\n}\n\nexport default useStateLink;\n"],"names":[],"mappings":"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"}